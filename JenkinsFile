pipeline {
    agent any

    tools {
        nodejs 'node-18.18.0' // Use the name defined in Global Tool Configuration
    }

    environment {
        AWS_REGION = 'ap-south-1'
        S3_BUCKET = 'lael-frontend'
        VITE_API_URL= 'dummy'
    }

    stages {
        stage('Update Environment') {
            steps {
                sh "rm -rf .env"
                sh "touch .env"
                sh "echo \"VITE_API_URL=${VITE_API_URL}\" >> .env"
            }
        }
        stage('Install Dependencies') {
            steps {
                script {
                    // Clean workspace before build
                    sh 'rm -rf node_modules .yarn/cache yarn.lock'
                    sh 'yarn cache clean'
                    sh 'yarn install'
                }
                // Install dependencies
                
            }
        }
        stage('Build Application') {
            steps {
                // Build the application (adjust build command as needed)
                sh 'npm run build'
            }
        }
        stage('Upload to S3') {
            steps {
                script {
                    sh "aws s3 cp --recursive out/ s3://${S3_BUCKET}/"
                }
            }
        }
    }

    post {
        always {
            // Clean the workspace after build
            cleanWs()
        }
    }
}
